<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <script
      defer
      src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"
    ></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
      :root {
        font-size: 62.5%;
      }
      body {
        font-size: 1.6rem;
      }
      dialog {
        max-width: none;
        max-height: none;
      }
      dialog::backdrop {
        background-color: #00000063;
      }
      .toggle-todos {
        display: flex;
        gap: 1.5rem;
        padding-bottom: 1.5rem;
        .btn-group {
          input {
            display: none;
            &:checked {
              & + label {
                border-bottom: 3px solid #fff;
                background-color: #ffffff3e;
              }
            }
          }
          label {
            display: flex;
            justify-content: center;
            padding: 0.5rem 1rem;
            color: #fff;
            font-size: 1.8rem;
            cursor: pointer;
          }
        }
      }
    </style>
  </head>

  <body>
    <div
      class="main-container h-screen relative grid grid-rows-[5.5rem_calc(100vh-(calc(5.5rem+10rem)))_10rem]"
      x-data="{
        showDialog: false,
        todos: [
            {
                id: 1,
                title: 'Finish Math Homework',
                date: '2025-08-20',
                priority: 'high',
                completed: false,
            },
            {
                id: 2,
                title: 'Buy Groceries',
                date: '2025-08-25',
                priority: 'medium',
                completed: false,
            },
            {
                id: 3,
                title: 'Clean Kitchen',
                date: '2025-08-22',
                priority: 'medium',
                completed: false,
            },
            {
                id: 4,
                title: 'Fix TV',
                date: '2025-08-24',
                priority: 'low',
                completed: false,
            },
        ],
        completedTodos: [],

        errMessages: [],
        todoForm: {
            title: '',
            desc: '',
            date: '',
            priority: ''
        },      

        validateTodoForm: function(){
            this.errMessages = []
            Object.keys(this.todoForm).map(todo => {
                if(todo !== 'desc' && todo !== 'completed'){
                  if(this.todoForm[todo] == ''){
                      this.errMessages.push(`${todo} is required`)
                  }
                }

            })
        },

        todoFormSubmit: function(){
            this.validateTodoForm();
            if(this.errMessages.length == 0){
            let newTodo = {
                id: this.todos.length + 1,
                title: this.todoForm.title,
                date: this.todoForm.date,
                priority: this.todoForm.priority
            }

            this.todos.unshift(newTodo)
            this.closeDialog()
            this.todoForm = {}
            }
        },

        editMode: false,
        editTodo: function(id){
            this.openDialog()
            this.editMode = true
            let editTodo = this.todos.filter((todo) => todo.id == id)[0] ?? this.completedTodos.filter((todo) => todo.id == id)[0]
            if(editTodo){
              this.todoForm = editTodo
            }else{

            }
        },

        openDialog: function(){
            this.showDialog = true
            this.$refs.dialog.showModal()
        },

        closeDialog: function(){
          if(!this.editMode){
            this.showDialog = false
            this.editMode = false
            this.todoForm = {
                title: '',
                desc: '',
                date: '',
                priority: ''
            };
            this.errMessages = []
            this.$refs.dialog.close()
          }
          if(this.editMode){
            if(this.errMessages.length > 0){
              return
            }else{
              this.showDialog = false
              this.editMode = false
              this.todoForm = {
                  title: '',
                  desc: '',
                  date: '',
                  priority: ''
              };
              this.errMessages = []
              this.$refs.dialog.close()
            }
          }
        },

        updateTodo: function(id){
            this.validateTodoForm();
            if(this.errMessages.length == 0){
            this.todos = this.todos.map((todo) => {
                if(todo.id == id){
                    return {
                        ...todo,
                        ...this.todoForm
                    }
                }
                return todo
            })

            this.editMode = false
            this.todoForm = {}
            this.closeDialog()
            }
        },

        deleteTodo: function(id){
            if(confirm('Are you sure you want to delete this todo?')){
                this.todos = this.todos.filter(todo => todo.id !== id)
                this.closeDialog()
            }
        },

        completeTodo: function(id){
          let todo = this.todos.find((td) => td.id == id)
          if(!todo) return

          this.todos = this.todos.filter((td) => td.id !== todo.id)
          this.completedTodos.push(todo)
        },

        undoTodo: function(id){
          let todo = this.completedTodos.find((td) => td.id == id)
          if(!todo) return

          this.completedTodos = this.completedTodos.filter((td) => td.id !== todo.id)
          this.todos.push(todo)
        },

        activeTab: 'incomplete'

    }"
    >
      <nav
        class="top-nav p-[1.2rem_2rem] bg-neutral-700 shadow-lg text-white flex items-center justify-between"
      >
        <h2 class="text-[2rem] font-bold">Todos</h2>
      </nav>
      <div
        class="bg-neutral-900 p-[1.5rem] pb-[calc(calc(7.5rem/2)+2rem)] overflow-auto"
      >
        <div class="toggle-todos">
          <div class="btn-group relative">
            <input
              type="radio"
              name="tab"
              id="incomplete"
              value="incomplete"
              x-model="activeTab"
              @checked="activeTab = 'incomplete'"
            />
            <label for="incomplete" class="">Remaining</label>
            <span
              class="counter bg-red-500 text-white w-[2rem] h-[2rem] flex items-center justify-center absolute text-[1.3rem] font-semibold top-[calc(-1*calc(2rem/2))] right-[calc(-1*calc(2rem/2))] rounded-full"
              x-text="todos.length"
            ></span>
          </div>
          <div class="btn-group relative">
            <input
              type="radio"
              name="tab"
              id="completed"
              value="completed"
              x-model="activeTab"
              @checked="activeTab = 'completed'"
            />
            <label for="completed" class="">Completed</label>
            <span
              class="counter bg-red-500 text-white w-[2rem] h-[2rem] flex items-center justify-center absolute text-[1.3rem] font-semibold top-[calc(-1*calc(2rem/2))] right-[calc(-1*calc(2rem/2))] rounded-full"
              x-text="completedTodos.length"
            ></span>
          </div>
        </div>
        <div
          class="todos-container grid grid-cols-[repeat(auto-fill,minmax(min(100%,32rem),1fr))] gap-[1.5rem]"
        >
          <div class="contents" x-show="activeTab == 'incomplete'">
            <template x-for="todo in todos" :key="todo.id">
              <!-- <div
              class="todo grid grid-cols-[1.6rem_1fr_7.5rem] gap-[1rem] bg-neutral-700 rounded-lg p-[1.2rem]"
              @click="editTodo(todo.id)"
            > -->
              <div
                class="todo grid grid-cols-[1.6rem_1fr_7.5rem] gap-[1rem] bg-neutral-700 rounded-lg p-[1.2rem]"
              >
                <div
                  class="completed-checkbox col-1 row-[1/span_2] flex items-center"
                >
                  <input
                    type="checkbox"
                    name=""
                    id=""
                    class="w-[1.6rem] h-[1.6rem] cursor-pointer"
                    x-model="todo.completed"
                    @change="completeTodo(todo.id)"
                  />
                </div>
                <div
                  class="task-title text-white text-[2rem] col-[2/span_1] row-1 leading-[1.1]"
                  x-text="todo.title"
                ></div>
                <div
                  class="dropdown-container row-1 col-3 flex justify-end relative"
                  x-data="{
                dropdownShow: false, 
              }"
                  @click.outside="dropdownShow = false"
                >
                  <button
                    type="button"
                    class="w-[2.5rem] h-[2.5rem] flex items-center justify-center cursor-pointer"
                    @click="dropdownShow = !dropdownShow"
                  >
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      viewBox="0 0 640 640"
                      class="fill-white w-full h-full"
                    >
                      <path
                        d="M320 208C289.1 208 264 182.9 264 152C264 121.1 289.1 96 320 96C350.9 96 376 121.1 376 152C376 182.9 350.9 208 320 208zM320 432C350.9 432 376 457.1 376 488C376 518.9 350.9 544 320 544C289.1 544 264 518.9 264 488C264 457.1 289.1 432 320 432zM376 320C376 350.9 350.9 376 320 376C289.1 376 264 350.9 264 320C264 289.1 289.1 264 320 264C350.9 264 376 289.1 376 320z"
                      />
                    </svg>
                  </button>
                  <ul
                    class="dropdown-list absolute top-full left-0 shadow bg-white rounded-xl overflow-hidden"
                    x-show="dropdownShow"
                  >
                    <li>
                      <button
                        type="button"
                        class="w-full p-[0.5rem_1.5rem] border-b border-neutral-200 text-left cursor-pointer hover:bg-neutral-200"
                        @click="editTodo(todo.id)"
                      >
                        Edit
                      </button>
                    </li>
                    <li>
                      <button
                        type="button"
                        class="text-red-500 p-[0.5rem_1.5rem] w-full text-left cursor-pointer hover:bg-neutral-200"
                        @click="deleteTodo(todo.id)"
                      >
                        Delete
                      </button>
                    </li>
                  </ul>
                </div>
                <div
                  class="task-start-time text-neutral-400 text-[1.6rem] leading-[1.1] col-2 row-2"
                  x-text="todo.date"
                ></div>
                <div
                  class="task-priority rounded-full text-[1.4rem] p-[0.5rem] col-3 row-2 capitalize text-center"
                  x-text="todo.priority"
                  :class="todo.priority == 'high' ?  'bg-red-300 border-2 border-red-900 text-red-900' : todo.priority == 'medium' ? 'bg-yellow-300 border-2 border-yellow-900 text-yellow-900' : 'bg-blue-300 border-2 border-blue-900 text-blue-900'"
                ></div>
              </div>
            </template>
          </div>
          <div class="contents" x-show="activeTab == 'completed'">
            <template x-for="todo in completedTodos" :key="todo.id">
              <!-- <div
              class="todo grid grid-cols-[1.6rem_1fr_7.5rem] gap-[1rem] bg-neutral-700 rounded-lg p-[1.2rem]"
              @click="editTodo(todo.id)"
            > -->
              <div
                class="todo grid grid-cols-[1.6rem_1fr_7.5rem] gap-[1rem] bg-neutral-700 rounded-lg p-[1.2rem]"
              >
                <div
                  class="completed-checkbox col-1 row-[1/span_2] flex items-center"
                >
                  <input
                    type="checkbox"
                    name=""
                    id=""
                    class="w-[1.6rem] h-[1.6rem] cursor-pointer"
                    x-model="todo.completed"
                    @change="undoTodo(todo.id)"
                  />
                </div>
                <div
                  class="task-title text-white text-[2rem] col-[2/span_2] row-1 leading-[1.1]"
                  x-text="todo.title"
                ></div>
                <div
                  class="dropdown-container row-1 col-3 flex justify-end relative"
                  x-data="{
                dropdownShow: false, 
              }"
                  @click.outside="dropdownShow = false"
                >
                  <button
                    type="button"
                    class="w-[2.5rem] h-[2.5rem] flex items-center justify-center cursor-pointer"
                    @click="dropdownShow = !dropdownShow"
                  >
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      viewBox="0 0 640 640"
                      class="fill-white w-full h-full"
                    >
                      <path
                        d="M320 208C289.1 208 264 182.9 264 152C264 121.1 289.1 96 320 96C350.9 96 376 121.1 376 152C376 182.9 350.9 208 320 208zM320 432C350.9 432 376 457.1 376 488C376 518.9 350.9 544 320 544C289.1 544 264 518.9 264 488C264 457.1 289.1 432 320 432zM376 320C376 350.9 350.9 376 320 376C289.1 376 264 350.9 264 320C264 289.1 289.1 264 320 264C350.9 264 376 289.1 376 320z"
                      />
                    </svg>
                  </button>
                  <ul
                    class="dropdown-list absolute top-full left-0 shadow bg-white rounded-xl overflow-hidden"
                    x-show="dropdownShow"
                  >
                    <li>
                      <button
                        type="button"
                        class="w-full p-[0.5rem_1.5rem] border-b border-neutral-200 text-left cursor-pointer hover:bg-neutral-200"
                        @click="editTodo(todo.id)"
                      >
                        Edit
                      </button>
                    </li>
                    <li>
                      <button
                        type="button"
                        class="text-red-500 p-[0.5rem_1.5rem] w-full text-left cursor-pointer hover:bg-neutral-200"
                        @click="deleteTodo(todo.id)"
                      >
                        Delete
                      </button>
                    </li>
                  </ul>
                </div>
                <div
                  class="task-start-time text-neutral-400 text-[1.6rem] leading-[1.1] col-2 row-2"
                  x-text="todo.date"
                ></div>
                <div
                  class="task-priority rounded-full text-[1.4rem] p-[0.5rem] col-3 row-2 capitalize text-center"
                  x-text="todo.priority"
                  :class="todo.priority == 'high' ?  'bg-red-300 border-2 border-red-900 text-red-900' : todo.priority == 'medium' ? 'bg-yellow-300 border-2 border-yellow-900 text-yellow-900' : 'bg-blue-300 border-2 border-blue-900 text-blue-900'"
                ></div>
              </div>
            </template>
          </div>
        </div>
      </div>
      <nav class="bottom-nav bg-neutral-700 p-[2rem] z-[20] relative">
        <button
          type="button"
          class="add-todo absolute left-[50%] translate-x-[-50%] bg-purple-400 h-[7.5rem] w-[7.5rem] rounded-full bottom-[calc(100%-calc(7.5rem/2))] flex items-center justify-center cursor-pointer"
          @click="openDialog()"
        >
          <i data-lucide="plus" class="text-white w-[3.5rem] h-[3.5rem]"></i>
        </button>
      </nav>

      <dialog
        x-ref="dialog"
        @keydown.escape.prevent="closeDialog()"
        @close="closeDialog()"
        class="w-full bg-transparent h-full overflow-y-auto"
        :class="showDialog == true ? 'flex items-center justify-center' :''"
      >
        <div
          class="dialog-container h-auto max-h-[90%] w-[min(90%,55rem)] bg-neutral-700 rounded-2xl p-[1.5rem] my-auto text-white relative"
        >
          <button
            type="button"
            class="w-[3.5rem] h-[3.5rem] rounded-full bg-black flex items-center justify-center absolute top-[calc(-1*(calc(3.5rem/2)))] right-[calc(-1*(calc(3.5rem/2)))] border border-white cursor-pointer"
            @click="closeDialog()"
          >
            <i data-lucide="x" class="text-white w-1/2 h-1/2"></i>
          </button>
          <h2
            class="border-b-2 border-neutral-500 pb-[1rem] text-[2rem] text-center"
            x-show="!editMode"
          >
            Add Todo
          </h2>
          <h2
            class="border-b-2 border-neutral-500 pb-[1rem] text-[2rem] text-center"
            x-show="editMode"
          >
            Edit Todo
          </h2>
          <form class="pt-[2rem] flex flex-col gap-[1.2rem]" @submit.prevent="">
            <ul
              class="error-list list-disc pl-[1.5rem]"
              x-show="errMessages.length > 0"
            >
              <template x-for="err in errMessages" :key="err">
                <li x-text="err" class="text-red-400"></li>
              </template>
            </ul>
            <div class="form-group">
              <input
                type="text"
                name=""
                id=""
                class="form-control border-2 border-neutral-500 rounded-md p-[1.2rem] text-[1.5rem] w-full"
                placeholder="Todo Title"
                x-model="todoForm.title"
                @input="todoForm.title == '' ? errMessages.push('title is required') : errMessages.pop()"
              />
            </div>
            <div class="form-group">
              <textarea
                name=""
                id=""
                class="form-control border-2 border-neutral-500 rounded-md p-[1.2rem] text-[1.5rem] w-full"
                placeholder="Todo Description"
                x-model="todoForm.desc"
              ></textarea>
            </div>
            <div class="form-group">
              <input
                type="date"
                name=""
                id=""
                class="form-control border-2 border-neutral-500 rounded-md p-[1.2rem] text-[1.5rem] w-full"
                x-model="todoForm.date"
                @input="todoForm.date == '' ? errMessages.push('date is required') : errMessages.pop()"
              />
            </div>
            <div class="form-group">
              <select
                name=""
                id=""
                class="form-control border-2 border-neutral-500 rounded-md p-[1.2rem] text-[1.5rem] w-full bg-neutral-700 text-white"
                x-model="todoForm.priority"
                @change="todoForm.priority == '' ? errMessages.push('priority is required'): errMessages.pop()"
              >
                <option value="">Select Todo Priority</option>
                <option value="high">High</option>
                <option value="medium">Medium</option>
                <option value="low">Low</option>
              </select>
            </div>
            <div class="form-action flex justify-center gap-[1.5rem]">
              <button
                type="button"
                class="text-[1.8rem] p-[0.75rem_2rem] min-w-[8.5rem] text-white rounded-full bg-purple-400 text-center cursor-pointer"
                x-show="!editMode"
                @click="todoFormSubmit()"
              >
                Add
              </button>
              <!-- <button
                type="button"
                class="text-[1.8rem] p-[0.75rem_2rem] min-w-[8.5rem] text-white rounded-full bg-red-400 text-center"
                x-show="editMode"
                @click="deleteTodo(todoForm.id)"
              >
                Delete
              </button> -->
              <button
                type="button"
                class="text-[1.8rem] p-[0.75rem_2rem] min-w-[8.5rem] text-white rounded-full bg-purple-400 text-center cursor-pointer"
                x-show="editMode"
                @click="updateTodo(todoForm.id)"
              >
                Update
              </button>
            </div>
          </form>
        </div>
      </dialog>
    </div>
  </body>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      lucide.createIcons();
    });
  </script>
</html>
